<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Carlos Willy Ruiz Villalobos /Albert Gaitan Pezo">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link type="image/png" sizes="16x16" rel="icon" href="https://img.icons8.com/3d-fluency/94/user-shield.png">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&family=Source+Sans+Pro:wght@300;400&display=swap" rel="stylesheet">
    <style>

        body {
            background-color: #f5f5f5;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
        }
        table.table-center td, table.table-center th {
            text-align: center;
            vertical-align: middle;
            height: 2.48rem;
            background-color: silver;
        }
        .bg-yellow{
            background-color: #faf206 !important;
        }
        .bg-dark{
            background-color: #8e44ad !important;
        }
        .bg-info{
            background-color: #2c3e50 !important;
        color: #fff;
        }
		.buttons-container {
		    display: flex;
		    gap: 5px;
		    justify-content: space-between;
		}
    </style>
    <title>MATRIZ DE RIESGO -WIGA-UNSM-FISI</title>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col">
                <header class="bg-light py-3">
                    <div class="container">
                      <div class="row">
                        <div class="col-md-4">
                            <img src="https://unsm.edu.pe/wp-content/uploads/2019/01/Logo-UNSM.png" alt="">
                        </div>
                        <div class="col-md-8">
                          <h1 class="text-primary text-end mb-0">UNIVERSIDAD NACIONAL DE SAN MARTIN</h1>
                          <h2 class="text-end mb-0">Facultad de Ingenieria de Sistemas e Informática</h2>
                        </div>
                      </div>
                    </div>
                  </header>
            </div>
        </div><br>
        <div class="row">
            <div class="col-lg-8">
                <div class="row">
                    <div class="col-4">
                        
                    </div>
                    <div class="col-8">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                <tr>
                                    <td colspan="5" class="bg-info text-center">IMPACTO</td>
                                </tr>
                                <tr>
                                    <td class="bg-dark text-white" style="width:100px;">Mínima</td>
                                    <td class="bg-dark text-white" style="width:100px;">Menor</td>
                                    <td class="bg-dark text-white" style="width:100px;">Moderada</td>
                                    <td class="bg-dark text-white" style="width:100px;">Mayor</td>
                                    <td class="bg-dark text-white" style="width:100px;">Máxima</td>
                                </tr>
                                <tr>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,2,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,3,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,4,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                    <tr><td class="bg-dark text-white">Muy Alta</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,0,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td></tr>
                                    <tr>
                                        <td class="bg-dark text-white">Alta</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,1,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td></tr>
                                    <tr>
                                        <td class="bg-dark text-white">Media</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,2,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td></tr>
                                    <tr>
                                        <td class="bg-dark text-white">Baja</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,3,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td></tr>
                                    <tr>
                                        <td class="bg-dark text-white">Muy Baja</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,4,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td>
                                    </tr>
                                    <tr class="bg-info">
                                        <td class="bg-info text-white text-center" colspan="2" >PROBABILIDAD</td>
                                    </tr>
                            </table>
                        </div>
                    </div>
                    <div class="col-8">
                        
                        <div class="table-responsive">
                            <table id="table-matriz" class="table table-bordered table-sm table-center">
                                
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="d-flex justify-content-end mb-2"><button data-bs-toggle="modal" data-bs-target="#modal_evento" class="btn btn-primary float-right btn-sm">Crear evento</button></div>
                <div class="table-responsive">
                    <table class="w-100 table table-sm  table-bordered">
                        <thead>
                            <th style="font-size:11px; text-align: center;">Evento</th>
                            <th style="font-size:11px; text-align: center;">Probabilidad</th>
                            <th style="font-size:11px; text-align: center;">Impacto</th>
                            <th style="font-size:11px; text-align: center;">Valor</th>
                            <th style="font-size:11px; text-align: center;">Nivel de Riesgo</th>
                            <th style="font-size:11px; text-align: center;">Opciones</th>
                        </thead>
                        <tbody id="table-eventos">
                            
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-12 col-lg-5">
                <div class="table-responsive">
                    <table class="table table-sm table-bordered" style="font-size:12px !important">
                        <thead>
                            <tr>
                                <th rowspan="2">Color</th>
                                <th style="font-size:11px" rowspan="2">Nivel de Riesgo</th>
                                <th style="font-size:11px" colspan="2">Rango</th>
                            </tr>
                            <tr>
                                
                                <th style="font-size:11px;width:100px">De</th>
                                <th style="font-size:11px;width:100px">A</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="bg-success"></td>
                                <td>Riesgo Aceptable</td>
                                <td><input oninput="SS.triggerEscala(0,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                <td><input oninput="SS.triggerEscala(0,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                            </tr>
                            <tr>
                                <td class="bg-yellow"></td>
                                <td>Riesgo Tolerable</td>
                                <td><input oninput="SS.triggerEscala(1,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                <td><input oninput="SS.triggerEscala(1,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                            </tr>
                            <tr>
                                <td class="bg-warning"></td>
                                <td>Riesgo Alto</td>
                                <td><input oninput="SS.triggerEscala(2,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                <td><input oninput="SS.triggerEscala(2,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                            </tr>
                            <tr>
                                <td class="bg-danger"></td>
                                <td>Riesgo Extremo</td>
                                <td><input oninput="SS.triggerEscala(3,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                <td><input oninput="SS.triggerEscala(3,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-6 col-lg-3">
                <img src="/img/riesgo.avif" class="img-fluid" width="350">
            </div>
            <div class="col-6 col-lg-4">
                <h3 class="text-end text-secondary mb-0">Matriz de Riesgos</h3>
                <p class="text-end mb-0">
                
            </div>
        </div>

        <div class="modal" tabindex="-1" id="modal_evento">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Crea un evento de Riesgo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="form_evento">
                        <div class="mb-3">
                          <label for="evento" class="form-label">Nombre del evento</label>
                          <input type="text" class="form-control" id="evento" name="evento">
                        </div>
                        <div class="mb-3">
                          <label for="probabilidad" class="form-label">Probabilidad</label>
                          <select class="form-select" id="probabilidad" name="probabilidad">
                            <option value="4">Muy alta</option>
                            <option value="3">Alta</option>
                            <option value="2">Media</option>
                            <option value="1">Baja</option>
                            <option value="0">Muy baja</option>
                          </select>
                        </div>
                        <div class="mb-3">
                          <label for="impacto" class="form-label">Impacto</label>
                          <select class="form-select" id="impacto" name="impacto">
                            <option value="0">Mínima</option>
                            <option value="1">Menor</option>
                            <option value="2">Moderada</option>
                            <option value="3">Mayor</option>
                            <option value="4">Máxima</option>
                          </select>
                        </div>
                      </form>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="SS.createEvent()" class="btn btn-primary">Crear Evento</button>
                </div>
                </div>
            </div>
        </div>
		<button type="button" onclick="logout()" class="btn btn-primary">Cerrar Sesion</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script type="text/javascript">
		const empresaId = localStorage.getItem('idempresa');
        const myModal = new bootstrap.Modal(document.getElementById('modal_evento'), {keyboard: false});
		const SS = {
		    impacto : [0,0,0,0,0],
		    proba : [0,0,0,0,0],
		    name:{
		        impacto:['Mínima','Menor','Moderada','Mayor','Máxima'],
		        proba:['Muy alta','Alta','Media','Baja','Muy baja']
		    },
		    matriz :[],
		    eventos:[],
		    escalas : [
		        {color:'#198754',nivel:'Riesgo Aceptable',rango:[0,0]},
		        {color:'#faf206',nivel:'Riesgo Tolerable',rango:[0,0]},
		        {color:'#ffc107',nivel:'Riesgo Alto',rango:[0,0]},
		        {color:'#dc3545',nivel:'Riesgo Extremo',rango:[0,0]}
		    ],
		
		    init: async () => {
		        for(let i=0; i<SS.proba.length; i++){
		            SS.matriz[i] = [];
		            for(let j=0; j<SS.impacto.length; j++){
		                SS.matriz[i][j] = {color:'#silver',value:0};
		            }
		        }
		        SS.renderMatriz();
		        await SS.loadEvents();
		    },
		    
			loadEvents: async () => {
			    try {
					const response = await fetch(`http://localhost:5555/evento/all/${empresaId}`, {
					    method: 'GET',
					    headers: {
					        'Authorization': `Bearer ${localStorage.getItem('token')}`
					    }
					});
					
					if (!response.ok) {
					    throw new Error('Error al obtener los eventos');
					}
					
			        const events = await response.json();
			        console.log("Eventos obtenidos en JSON:", events);
			
			        SS.eventos = events.map(event => {
			            const matriz = SS.matriz[event.probabilidad - 1][event.impacto - 1];
			
			            const escalaFiltrada = SS.escalas.filter(res => res.color === matriz?.color);
			            const riesgo = escalaFiltrada.length > 0 ? escalaFiltrada[0].nivel : 'No definido';
			
			            return {
			                evento: event.name,
			                probabilidad: SS.name.proba[event.probabilidad - 1],
			                impacto: SS.name.impacto[event.impacto - 1],
			                color: event.color,
			                valor: event.valorRiesgo,
			                riesgo: event.nivel,
							id: event.id
			            };
			        });
			
			        SS.renderEventos();
			    } catch (error) {
			        console.error("Error al cargar eventos:", error);
			    }
			},
		    
		    triggerHeaders:(tipo,x,value)=>{
		        if(tipo==0){
		            SS.impacto[x] = parseInt(value);
		        }else if(tipo==1){
		            SS.proba[x] = parseInt(value);
		        }
		        SS.createMatriz();
		    },
		    
		    createMatriz:()=>{
		        for(let i=0;i<SS.proba.length;i++){
		            for(let j=0;j<SS.impacto.length;j++){
		                const value = SS.proba[i] * SS.impacto[j];
		                let color= 'silver';
		                SS.escalas.map(res=>{
		                    if(res.rango[0]>0 && res.rango[1]>0){
		                        if(value >= res.rango[0] && value <= res.rango[1]){
		                            color = res.color;
		                        }
		                    }
		                });
		                SS.matriz[i][j] = {color:color, value:value}; 
		            }
		        }
		        SS.renderMatriz();
		    },
		
		    renderMatriz:()=>{
		        let html = '';
		        for(let i=0;i<SS.matriz.length;i++){
		            html += '<tr>';
		            for(let j=0;j<SS.matriz[i].length;j++){
		                html += `<td class="text-white" style="background-color:${SS.matriz[i][j].color}">${SS.matriz[i][j].value}</td>`;
		            }
		            html += '</tr>';
		        }
		        document.querySelector('#table-matriz').innerHTML = html;
		    },
		
		    triggerEscala:(i,x,value)=>{
		        SS.escalas[i].rango[x] = parseInt(value);
		        SS.createMatriz();
		    },
		
			createEvent: async () => {
			    try {
			        const formData = new FormData(document.querySelector('#form_evento'));
			        const formObj = Object.fromEntries(formData.entries());
			        if (formObj.evento.length == 0) throw 'Debe ingresar un nombre de evento';
			        if (SS.proba.indexOf(0) > -1) throw 'Debe ingresar un valor mayor de cero para todas las probabilidades';
			        if (SS.impacto.indexOf(0) > -1) throw 'Debe ingresar un valor mayor de cero para todos los impactos';
			        SS.escalas.map(res => {
			            if (res.rango[0] == 0 || res.rango[1] == 0) throw 'Debe ingresar un valor mayor de cero para todos los rangos de las escalas de riesgo';
			        });
			        
			        const newEvent = {
			            name: formObj.evento,
			            impacto: parseInt(formObj.impacto) + 1,
			            probabilidad: parseInt(formObj.probabilidad) + 1,
			            impacto_v: SS.impacto,
			            probabilidad_v: SS.proba,
			            riesgo_aceptable: SS.escalas[0].rango,
			            riesgo_tolerable: SS.escalas[1].rango,
			            riesgo_alto: SS.escalas[2].rango,
			            riesgo_extremo: SS.escalas[3].rango,
			            empresa: empresaId
			        };
			
			        const token = localStorage.getItem('token');
			        if (!token) throw 'No se ha encontrado un token de autenticación.';
			
			        const response = await fetch('http://localhost:5555/evento/new', {
			            method: 'POST',
			            headers: {
			                'Content-Type': 'application/json',
			                'Authorization': `Bearer ${token}`
			            },
			            body: JSON.stringify(newEvent)
			        });
			
			        if (response.ok) {
			            const data = await response.json();
			
			            const recomendacion = data.map(item => item.output.content)
			
			            Swal.fire({
			                icon: 'success',
			                title: 'Evento creado con éxito',
			                text: 'El evento ha sido creado exitosamente. A continuación, las recomendaciones:',
			                html: `<p>${recomendacion}</p>`,
			                showConfirmButton: true
			            });
			
			            const newEventData = {
			                evento: formObj.evento,
			                probabilidad: SS.name.proba[formObj.probabilidad],
			                impacto: SS.name.impacto[formObj.impacto],
			                color: SS.matriz[formObj.probabilidad][formObj.impacto].color,
			                valor: SS.matriz[formObj.probabilidad][formObj.impacto].value,
							estadoFirmado: 0,
							nombreInforme: "Sin informe"
			            };
			
			            const escalaFiltrada = SS.escalas.find(res => res.color === newEventData.color);
			            newEventData.riesgo = escalaFiltrada ? escalaFiltrada.nivel : 'No definido';
			
			            SS.eventos.push(newEventData);
			            SS.loadEvents();
			            SS.renderEventos();
			            myModal.hide();
			        } else {
			            throw 'Error al crear el evento. Por favor, inténtelo de nuevo.';
			        }
			    } catch (error) {
			        alert(error);
			    }
			},
		
		    renderEventos:()=>{
		        let html = '';
		        SS.eventos.forEach((res, i) => {
		            html += `<tr>
		                        <td style="font-size:11px; text-align: center;">${res.evento}</td>
		                        <td style="font-size:11px; text-align: center;">${res.probabilidad}</td>
		                        <td style="font-size:11px; text-align: center;">${res.impacto}</td>
		                        <td style="font-size:11px; text-align: center;">${res.valor}</td>
		                        <td style="background-color:${res.color};font-size:11px; text-align: center;">${res.riesgo}</td>
		                        <td class="buttons-container">
									<button onclick="SS.generatePDF(${res.id})" class="btn btn-primary btn-sm">Generar PDF</button>
									<button onclick="SS.loadPDF(${res.id})" class="btn btn-primary btn-sm">Subir PDF</button>
									<button onclick="SS.firmarPDF(${res.id})" class="btn btn-primary btn-sm">Firmar PDF</button>
									<button onclick="SS.download(${res.id})" class="btn btn-primary btn-sm">Descargar PDF</button>
									<button onclick="SS.removeEvento(${res.id})" class="btn btn-danger btn-sm">Quitar</button>				
								</td>
		                    </tr>`;
		        });
		        document.querySelector('#table-eventos').innerHTML = html;
		    },
			
			generatePDF: (id) => 
			{
				localStorage.setItem('idevento', id);
				window.location.href = '/pdf';
			},
			
			loadPDF: (id) => 
			{
				Swal.fire({
				    title: "Subir un PDF",
				    input: "file",
				    inputAttributes: {
				        accept: "application/pdf",
				        "aria-label": "Sube tu archivo PDF"
				    },
				    showCancelButton: true,
				    confirmButtonText: "Subir",
				    cancelButtonText: "Cancelar",
				    inputValidator: (file) => {
				        if (!file) {
				            return "¡Debes seleccionar un archivo!";
				        } else if (file.type !== "application/pdf") {
				            return "¡El archivo debe ser un PDF!";
				        }
				    }
				}).then((result) => 
				{
				    if (result.isConfirmed) 
					{
				        const file = result.value;
						
						console.log(file);
				
				        const formData = new FormData();
				        formData.append("informe", file);
						formData.append("idevento", id);
						
					    formData.forEach((value, key) => {
					        console.log(`${key}: ${value}`);
					    });

						const token = localStorage.getItem("token");
						
				        if (!token) {
				            Swal.fire("¡Error!", "No se encontró el token de autenticación.", "error");
				            return;
				        }
										
				        fetch("http://localhost:5555/evento/upload", {
				            method: "POST",
				            body: formData,
							headers: {
				                Authorization: `Bearer ${token}`
				            }
				        })
			            .then(response => 
						{
						   if(response.status === 200)
   						   {
   							Swal.fire("¡Éxito!", "El archivo se ha subido correctamente.", "success");
   						   }
						   else
						   {
							Swal.fire("¡Error!", "Hubo un problema al subir el archivo.", "error");
						   }
						})
				    }
				});
			},
			
			firmarPDF: (id) => 
			{
				Swal.fire({
			        title: "Ingrese su contraseña",
			        input: "password",
			        inputLabel: "Contraseña",
			        inputPlaceholder: "Digite su contraseña",
			        inputAttributes: {
			            autocapitalize: "off",
			            autocorrect: "off"
			        },
			        inputValidator: (value) => {
			            if (!value) {
			                return 'La contraseña es requerida!';
			            }
			        }
			    }).then((result) => 
				{
				    if (result.isConfirmed) 
					{
						let password = result.value;
						let token = localStorage.getItem("token");

						const requestBody = 
						{
					      username: localStorage.getItem("username"),
					      password: password,
						  idEvento: id
					    };
						
				        fetch(`http://localhost:5555/evento/firmarinforme`, {
				            method: "POST",
				            headers: {
								'Content-Type': 'application/json',
				                "Authorization": `Bearer ${token}`,
				            },
				            body: JSON.stringify(requestBody)
				        }).then(response =>
						{
						   if(response.status === 200)
   						   {
   							Swal.fire("¡Éxito!", "El archivo se ha firmado.", "success");
   						   }
						   else
						   {
							Swal.fire("¡Error!", "Hubo un problema al firmar el archivo.", "error");
						   }
						})
				    }
				});
			},
			
			download: (id) => 
			{
				const token = localStorage.getItem('token'); 
				
			    if (!token) {
			        console.error('Token no encontrado en localStorage');
			        return; 
			    }
			
			    fetch(`http://localhost:5555/evento/download/${id}`, {
			        method: 'GET',
			        headers: {
			            'Accept': 'application/pdf',  
			            'Authorization': `Bearer ${token}`, 
			        }
			    })
			    .then(response => {
			        if (!response.ok) {
			            throw new Error('No se pudo descargar el archivo');
			        }
			
			        const contentDisposition = response.headers.get('Content-Disposition');
			        const matches = /filename="([^"]+)"/.exec(contentDisposition);
			        const filename = matches && matches[1] ? matches[1] : 'informe.pdf';
			
			        return response.blob().then(blob => 
					{
			            const url = window.URL.createObjectURL(blob);
			            const a = document.createElement('a');
			            a.style.display = 'none'; 
			            a.href = url;
			            a.download = filename; 
			            document.body.appendChild(a);
			            a.click();
			            window.URL.revokeObjectURL(url);
			        });
			    })
			    .catch(error => {
			        console.error('Error al descargar el archivo:', error);
			    });
			},
			
		    removeEvento: (id) => 
			{
				const url = `http://localhost:5555/evento/delete/${id}`;
			    Swal.fire({
			        title: '¿Estás seguro?',
			        text: "¡No podrás revertir esta acción!",
			        icon: 'warning',
			        showCancelButton: true,
			        confirmButtonColor: '#3085d6',
			        cancelButtonColor: '#d33',
			        confirmButtonText: 'Sí, eliminarlo',
			        cancelButtonText: 'Cancelar'
			    }).then((result) => {
			        if (result.isConfirmed) {
			            fetch(url, {
			                method: 'DELETE',
							headers: {'Authorization': `Bearer ${localStorage.getItem('token')}`}
			            })
			            .then(response => {
							if (response.ok) {
			                    Swal.fire(
			                        'Eliminado',
			                        'El evento ha sido eliminado.',
			                        'success'
			                    ).then(() => {
			                        window.location.reload();
			                    });
			                } else {
			                    Swal.fire(
			                        'Error',
			                        'Hubo un problema al eliminar el evento.',
			                        'error'
			                    );
			                }
			            })
			            .catch(error => {
			                Swal.fire(
			                    'Error',
			                    'Ocurrió un error inesperado.',
			                    'error'
			                );
			                console.error('Error:', error);
			            });
			        }
			    });
				
		    }
		}
		
		document.addEventListener('DOMContentLoaded', () => {
		    SS.init();
		});
		
		function getEmpresaIdFromUrl() {
		    const params = new URLSearchParams(window.location.search);
		    return params.get('empresaId');
		}
		
		async function logout()
		{
			const url = 'http://localhost:5555/auth/logout';
			    
		    try {
		        const response = await fetch(url, {
		            method: 'POST',
		            headers: {
		                'Authorization': `Bearer ${localStorage.getItem('token')}`,
		                'Content-Type': 'application/json'
		            }
		        });
		
		        if (response.ok) 
				{
		            localStorage.removeItem('token');
		            
		            Swal.fire({
		                title: 'Cierre de sesión exitoso',
		                text: 'Has cerrado sesión correctamente.',
		                icon: 'success',
		                confirmButtonText: 'OK'
		            }).then(() => {
		                window.location.href = '/login';
		            });
		        } else {
		            Swal.fire({
		                title: 'Error',
		                text: 'No se pudo cerrar sesión correctamente.',
		                icon: 'error',
		                confirmButtonText: 'OK'
		            });
		        }
		    } catch (error) {
		        Swal.fire({
		            title: 'Error',
		            text: 'Ocurrió un error inesperado.',
		            icon: 'error',
		            confirmButtonText: 'OK'
		        });
		        console.error('Error:', error);
		    }
		}
    </script>
</body>
</html>